/***************************************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2017 Regents of the University of California
 *
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 *
 * SmarterApp Open Source Assessment Software Project: http://smarterapp.org
 * Developed by Fairway Technologies, Inc. (http://fairwaytech.com)
 * for the Smarter Balanced Assessment Consortium (http://smarterbalanced.org)
 **************************************************************************************************/

package org.opentestsystem.delivery.logging;

import javax.servlet.http.HttpServletRequest;
import java.util.Map;

public abstract class EventParserFactory {

  /**
   * Implement this to provide the map of PATHINFO to EventParser Classes.
   *
   * @return
   */
  protected abstract Map<String, Class<? extends EventParser>> getEventParserClassMap();

  /**
   * Returns an EventParser for the current request, as discovered via request.getPathInfo().
   * Used by logging interceptor to pull data out of the request and response for event logging.
   *
   * @param request
   * @return
   * @throws IllegalAccessException
   * @throws InstantiationException
   */
  public EventParser get(HttpServletRequest request) throws IllegalAccessException, InstantiationException {
    if (getEventParserClassMap().containsKey(request.getPathInfo())) {
      return getEventParserClassMap().get(request.getPathInfo()).newInstance();
    }
    if (getEventParserClassMap().containsKey("*")) {
      return getEventParserClassMap().get("*").newInstance();
    }
    return new EventParser();
  }

}
