package org.opentestsystem.delivery.logging;

import javax.servlet.http.HttpServletRequest;
import java.util.Map;

import static org.opentestsystem.delivery.logging.EventParser.getPath;

public abstract class EventParserFactory {

  /**
   * Implement this to provide the map of PATHINFO to EventParser Classes.
   *
   * @return A map of PATHINFO to EventParser
   */
  protected abstract Map<String, Class<? extends EventParser>> getEventParserClassMap();

  /**
   * Returns an EventParser for the current request, as discovered via request.getPathInfo().
   * Used by logging interceptor to pull data out of the request and response for event logging.
   *
   * @param request The request
   * @return The associated EventParser
   * @throws IllegalAccessException
   * @throws InstantiationException
   */
  public EventParser get(final HttpServletRequest request) throws IllegalAccessException, InstantiationException {
    if (getEventParserClassMap().containsKey(getPath(request))) {
      return getEventParserClassMap().get(getPath(request)).newInstance();
    }
    if (getEventParserClassMap().containsKey("*")) {
      return getEventParserClassMap().get("*").newInstance();
    }
    return new EventParser();
  }

}
